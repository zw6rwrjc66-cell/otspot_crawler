# 🎯 手动触发爬取功能说明

## ✅ 已完成的修改

### 1️⃣ 后端改动
- ❌ **禁用了自动定时任务** - 不再每30分钟自动爬取
- ✅ **保留手动触发接口** - `/crawl` 端点仍然可用
- ✅ **更新调度器状态API** - 返回"手动触发模式"状态

### 2️⃣ 前端改动
- ✅ **添加时间范围选择器** - 可选择要查看的时间段数据
- ✅ **优化爬取按钮** - 移到筛选卡片中，更加醒目
- ✅ **更新状态卡片** - 显示"手动模式"和使用说明
- ✅ **简化页面头部** - 移除自动刷新开关，显示"手动触发模式"标签

## 🎨 新界面功能

### 筛选与爬取控制卡片
位置：页面顶部

包含三个主要功能：

1. **数据源筛选**
   - 下拉选择框
   - 可选择：微博热搜、百度热搜、抖音热搜、今日头条
   - 支持"全部数据源"

2. **时间范围选择**
   - 日期时间范围选择器
   - 可精确到分钟
   - 用于筛选显示特定时间段的数据

3. **立即爬取按钮**
   - 大号蓝色按钮
   - 点击后立即执行爬取任务
   - 爬取完成后自动刷新数据

### 爬取模式卡片
位置：右侧栏

显示内容：
- 🔵 **模式标签**: "手动模式"
- 📝 **模式说明**: "手动触发模式"
- 💬 **使用提示**: "需要手动点击按钮触发爬取"
- 💡 **操作指引**: "在上方选择时间范围后，点击'立即爬取'按钮开始抓取"

## 📖 使用方法

### 基本爬取流程

1. **打开前端页面**
   ```
   http://localhost:5173
   ```

2. **（可选）选择数据源**
   - 在"数据源"下拉框中选择特定平台
   - 或保持"全部数据源"

3. **（可选）选择时间范围**
   - 点击"时间范围"选择器
   - 选择开始和结束时间
   - 用于筛选显示特定时间段的历史数据

4. **点击"立即爬取"**
   - 点击蓝色大按钮
   - 等待2秒，系统自动刷新
   - 查看最新抓取的数据

### 示例场景

#### 场景1：查看所有平台最新热点
```
1. 不选择数据源（显示全部）
2. 不选择时间范围（显示所有）
3. 点击"立即爬取"
4. 查看所有平台的TOP 3热点
```

#### 场景2：只查看微博热搜
```
1. 数据源选择"微博热搜"
2. 不选择时间范围
3. 点击"立即爬取"
4. 只显示微博的TOP 3热点
```

#### 场景3：查看特定时间段的数据
```
1. 选择时间范围（如：今天上午10:00 - 12:00）
2. 点击"立即爬取"（会先抓取最新数据）
3. 时间筛选器会过滤显示该时间段的历史数据
```

## 🔧 技术实现

### 后端修改
文件：`backend/main.py`

```python
# 禁用自动调度器
# scheduler = BackgroundScheduler()
# scheduler.add_job(run_crawler_task, 'interval', minutes=30)
# scheduler.start()

# 更新状态API
@app.get("/scheduler/status")
def get_scheduler_status():
    return {
        "status": "manual_only",
        "mode": "手动触发模式",
        "description": "需要手动点击按钮触发爬取"
    }
```

### 前端修改
文件：`frontend/src/App.jsx`

主要改动：
1. 导入 `DatePicker` 和 `RangePicker`
2. 添加 `dateRange` 状态
3. 创建新的筛选卡片，包含：
   - 数据源选择器
   - 时间范围选择器
   - 立即爬取按钮
4. 更新爬取模式卡片显示

## 📊 数据流程

```
用户操作 → 点击"立即爬取" → 调用 /crawl API → 
后端执行爬取 → 抓取各平台TOP 3 → 存入数据库 → 
前端自动刷新 → 显示最新数据
```

## ⚠️ 注意事项

1. **时间范围选择器**
   - 仅用于筛选**已抓取**的历史数据
   - 不会影响爬取行为（爬取始终获取最新数据）
   - 如果选择的时间段内没有数据，列表会显示为空

2. **数据源筛选**
   - 筛选仅影响显示，不影响爬取
   - 爬取时会同时抓取所有配置的数据源

3. **爬取频率**
   - 建议不要频繁点击"立即爬取"
   - 建议间隔至少5-10分钟
   - 避免对目标网站造成压力

4. **数据存储**
   - 每次爬取会向数据库添加新数据
   - 不会删除旧数据
   - 建议定期清理过期数据

## 🔄 如果想恢复自动定时爬取

编辑 `backend/main.py`，取消注释以下代码：

```python
# 恢复自动调度器
scheduler = BackgroundScheduler()
scheduler.add_job(run_crawler_task, 'interval', minutes=30)
scheduler.start()

# 恢复关闭事件
@app.on_event("shutdown")
def shutdown_event():
    scheduler.shutdown()
```

然后重启后端服务。

## 📝 更新日志

### v1.3.0 (2025-11-24)
- ✅ 改为手动触发模式，移除自动定时任务
- ✅ 前端添加时间范围选择器
- ✅ 优化爬取按钮位置和样式
- ✅ 更新爬取模式状态显示
- ✅ 简化页面头部，移除自动刷新开关
