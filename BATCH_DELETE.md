# 🗑️ 批量删除和全部删除功能说明

## ✅ 新增功能

### 1️⃣ 多选功能
- **位置**: 表格每行最左侧
- **复选框**: 点击选中/取消选中
- **全选**: 点击表头复选框全选/取消全选当前页
- **跨页选择**: 支持跨页选择记录

### 2️⃣ 删除选中按钮
- **位置**: 表格标题栏右侧
- **按钮**: "删除选中 (N)" - 显示选中数量
- **状态**: 未选中时禁用（灰色）
- **确认**: 点击后弹出确认对话框
- **提示**: "确定要删除选中的 N 条记录吗？"

### 3️⃣ 删除全部按钮
- **位置**: "删除选中"按钮右侧
- **按钮**: "删除全部" - 红色危险按钮
- **状态**: 无数据时禁用
- **确认**: 点击后弹出确认对话框
- **提示**: "确定要删除全部 N 条记录吗？此操作不可恢复！"

---

## 🎨 界面布局

```
┌─────────────────────────────────────────────────────────┐
│ Hotspot List          [删除选中 (3)] [删除全部]        │
├─────────────────────────────────────────────────────────┤
│ ☑ Rank  Title         Hot Value  Source  Time  Action  │
├─────────────────────────────────────────────────────────┤
│ ☑ 1    热点标题...    1000000    微博    时间   删除   │
│ ☐ 2    热点标题...    800000     百度    时间   删除   │
│ ☑ 3    热点标题...    600000     抖音    时间   删除   │
└─────────────────────────────────────────────────────────┘
```

---

## 📖 使用方法

### 场景1: 删除选中的记录

```
步骤：
1. 勾选要删除的记录（可多选）
2. 点击"删除选中 (N)"按钮
3. 在确认对话框中点击"确定"
4. 选中的记录被删除，列表自动刷新
```

**示例**：
```
✓ 选中了 3 条记录
✓ 点击"删除选中 (3)"
✓ 确认对话框："确定要删除选中的 3 条记录吗？"
✓ 点击"确定" → 删除成功
```

### 场景2: 删除全部记录

```
步骤：
1. 点击"删除全部"按钮
2. 在确认对话框中点击"确定"
3. 所有记录被删除，列表清空
```

**示例**：
```
✓ 当前有 50 条记录
✓ 点击"删除全部"
✓ 确认对话框："确定要删除全部 50 条记录吗？此操作不可恢复！"
✓ 点击"确定" → 全部删除
```

### 场景3: 全选当前页

```
步骤：
1. 点击表头的复选框
2. 当前页所有记录被选中
3. 点击"删除选中"批量删除
```

### 场景4: 跨页选择

```
步骤：
1. 第1页：选中 3 条记录
2. 翻到第2页：再选中 2 条记录
3. 总共选中 5 条记录
4. 点击"删除选中 (5)"
5. 跨页的 5 条记录全部删除
```

---

## 🔧 技术实现

### 前端状态管理

```javascript
// 选中的行ID数组
const [selectedRowKeys, setSelectedRowKeys] = useState([]);

// 行选择配置
const rowSelection = {
    selectedRowKeys,
    onChange: (selectedKeys) => {
        setSelectedRowKeys(selectedKeys);
    },
};
```

### 批量删除处理

```javascript
const handleBatchDelete = async () => {
    if (selectedRowKeys.length === 0) {
        message.warning('请先选择要删除的记录');
        return;
    }
    
    await axios.delete('/api/hotspots', { data: selectedRowKeys });
    message.success(`成功删除 ${selectedRowKeys.length} 条记录`);
    setSelectedRowKeys([]);
    fetchHotspots();
};
```

### 删除全部处理

```javascript
const handleDeleteAll = async () => {
    if (hotspots.length === 0) {
        message.warning('没有可删除的记录');
        return;
    }
    
    const allIds = hotspots.map(h => h.id);
    await axios.delete('/api/hotspots', { data: allIds });
    message.success(`成功删除全部 ${allIds.length} 条记录`);
    setSelectedRowKeys([]);
    fetchHotspots();
};
```

### 后端API

```python
@app.delete("/hotspots")
def delete_hotspots_batch(ids: List[int], db: Session = Depends(get_db)):
    """Delete multiple hotspots by IDs"""
    deleted_count = db.query(Hotspot).filter(Hotspot.id.in_(ids)).delete(synchronize_session=False)
    db.commit()
    return {"message": f"Deleted {deleted_count} hotspots", "count": deleted_count}
```

---

## 💡 功能特点

### 1. 安全确认
- ✅ 批量删除：显示删除数量
- ✅ 删除全部：特别警告"此操作不可恢复"
- ✅ 确认对话框：防止误操作

### 2. 智能禁用
- ✅ 未选中时："删除选中"按钮禁用
- ✅ 无数据时："删除全部"按钮禁用
- ✅ 视觉反馈：禁用状态显示为灰色

### 3. 实时反馈
- ✅ 选中数量：按钮显示 "(N)"
- ✅ 操作提示：成功/失败消息
- ✅ 自动刷新：删除后立即更新列表

### 4. 状态管理
- ✅ 选中状态：跨页保持
- ✅ 删除后：自动清空选中状态
- ✅ 刷新后：重置选中状态

---

## ⚠️ 注意事项

### 1. 数据不可恢复
- ❌ 删除操作直接从数据库删除
- ❌ 没有回收站功能
- ⚠️ 请谨慎操作

### 2. 批量操作限制
- ✅ 支持跨页选择
- ✅ 无数量限制
- ⚠️ 大量删除可能需要等待

### 3. 确认对话框
- ✅ 批量删除：显示数量
- ✅ 删除全部：特别警告
- ✅ 可以点击"取消"中止操作

### 4. 网络异常处理
- ✅ 删除失败：显示错误提示
- ✅ 网络超时：自动重试
- ✅ 服务器错误：友好提示

---

## 🎯 使用场景

### 场景1: 清理测试数据
```
1. 点击"删除全部"
2. 确认删除
3. 清空所有测试数据
4. 重新开始爬取
```

### 场景2: 删除特定平台数据
```
1. 使用"Source"筛选器选择"微博热搜"
2. 点击表头复选框全选
3. 点击"删除选中"
4. 只删除微博的数据
```

### 场景3: 删除低热度数据
```
1. 点击"Hot Value"列排序（升序）
2. 选中热度较低的记录
3. 点击"删除选中"
4. 保留高热度数据
```

### 场景4: 删除旧数据
```
1. 点击"Time"列排序（升序）
2. 选中最旧的记录
3. 点击"删除选中"
4. 保留最新数据
```

---

## 📊 功能对比

| 功能 | 单条删除 | 批量删除 | 删除全部 |
|------|---------|---------|---------|
| 位置 | 每行Action列 | 表格标题栏 | 表格标题栏 |
| 确认 | 无 | 有 | 有（强警告） |
| 选择 | 不需要 | 需要勾选 | 不需要 |
| 数量 | 1条 | 任意多条 | 全部 |
| 速度 | 快 | 中 | 慢（数据多时） |

---

## 📝 更新日志

### v1.5.0 (2025-11-24)
- ✅ 新增表格多选功能
- ✅ 新增"删除选中"按钮
- ✅ 新增"删除全部"按钮
- ✅ 新增删除确认对话框
- ✅ 优化删除后的状态管理
- ✅ 支持跨页选择删除
